[gd_scene load_steps=25 format=3 uid="uid://0nk3tfn6rk4s"]

[ext_resource type="Script" uid="uid://bc5b7fp0eb10i" path="res://scripts/levels/LevelConfig.gd" id="1_2tpxt"]
[ext_resource type="PackedScene" uid="uid://bwc7siyf2lmfb" path="res://scenes/pipes/Pipe.tscn" id="1_nha0i"]
[ext_resource type="Script" path="res://scripts/managers/WaveManager.gd" id="1_rikml"]
[ext_resource type="Script" path="res://scripts/managers/Wave.gd" id="2_vc03v"]
[ext_resource type="Resource" uid="uid://bktbxy4finrku" path="res://scenes/levels/level01/waves/wave_01.tres" id="3_grv7h"]
[ext_resource type="PackedScene" uid="uid://c0glq8w37tx27" path="res://scenes/main/ParticleBackground.tscn" id="3_u1xfj"]
[ext_resource type="PackedScene" uid="uid://dbitchmue8nm6" path="res://scenes/others/enemy_spawn_point.tscn" id="4_1rhdn"]
[ext_resource type="PackedScene" uid="uid://cjvy6h27p17px" path="res://scenes/others/BridgeBuilder.tscn" id="4_abcde"]
[ext_resource type="Script" uid="uid://iwunwmox6qk5" path="res://scripts/managers/UIManager.gd" id="5_abcde"]
[ext_resource type="Script" uid="uid://dy1nyxpe7sr7n" path="res://scripts/ui/Overlay.gd" id="6_overlay"]
[ext_resource type="Script" uid="uid://cwq4oeccwuocx" path="res://scenes/main/ui_cancel.gd" id="7_tck0d"]
[ext_resource type="PackedScene" uid="uid://ddhalg244kw3t" path="res://scenes/ui/FPSCounter.tscn" id="8_ko0rf"]
[ext_resource type="PackedScene" uid="uid://dpsk4yq8w7h6g" path="res://scenes/ui/GameUI.tscn" id="9_gameui"]
[ext_resource type="Theme" uid="uid://dshck318jhgki" path="res://scenes/ui/Theme/MainUITheme.tres" id="10_theme"]
[ext_resource type="Shader" uid="uid://cul7dygdsicnj" path="res://assets/shader/pixelate.gdshader" id="15_tck0d"]
[ext_resource type="Script" uid="uid://1_tutorial_mgr" path="res://scripts/tutorial/TutorialManager.gd" id="16_tutorial_mgr"]
[ext_resource type="Resource" path="res://dialogues/tutorial_01.tres" id="17_tutorial_dialogue"]
[ext_resource type="Resource" path="res://dialogues/post_connect_dialogue.tres" id="18_post_connect_dialogue"]
[ext_resource type="Resource" path="res://dialogues/upgrade_dialogue.tres" id="19_upgrade_dialogue"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_u8lgh"]
size = Vector2(404, 236)

[sub_resource type="Curve2D" id="Curve2D_tck0d"]
_data = {
"points": PackedVector2Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -32, 0, 0, 0, 0, 0, -192, 128, 0, 0, 0, 0, 0, 128, 0, 0, 0, 0, 0, 0)
}
point_count = 5

[sub_resource type="Curve2D" id="Curve2D_u8lgh"]
_data = {
"points": PackedVector2Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 128, 0, 0, 0, 0, 0, 64, 130, 0, 0, 0, 0, 20, 117, 0, 0, 0, 0, 37, 45, 0, 0, 0, 0, 0, 0)
}
point_count = 6

[sub_resource type="Curve2D" id="Curve2D_hjnkw"]
_data = {
"points": PackedVector2Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -32, 0, 0, 0, 0, -144, -32, 0, 0, 0, 0, -144, 0, 0, 0, 0, 0, 0, 0)
}
point_count = 5

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_jsdfw"]
bg_color = Color(0.19607843, 0.19607843, 0.19607843, 0.49019608)
draw_center = false

[sub_resource type="ShaderMaterial" id="ShaderMaterial_u8lgh"]
shader = ExtResource("15_tck0d")
shader_parameter/pixel_size = 1.0

[sub_resource type="Animation" id="Animation_jsdfw"]
resource_name = "Win"
length = 3.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("UILayer/OverPanelContainer:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.5, 2.4, 2.9),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0), Color(1, 1, 1, 1), Color(1, 1, 1, 1), Color(1, 1, 1, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("UILayer/OverPanelContainer/ShaderRect:material:shader_parameter/pixel_size")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.5, 2.4, 2.9),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [100.0, 1.0, 1.0, 100.0]
}

[sub_resource type="Animation" id="Animation_hjnkw"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("UILayer/OverPanelContainer:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("UILayer/OverPanelContainer/ShaderRect:material:shader_parameter/pixel_size")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [1.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_tck0d"]
_data = {
&"RESET": SubResource("Animation_hjnkw"),
&"Win": SubResource("Animation_jsdfw")
}

[node name="Main" type="Node2D"]

[node name="LevelConfig" type="Node" parent="."]
script = ExtResource("1_2tpxt")

[node name="WaveManager" type="Node" parent="." node_paths=PackedStringArray("spawners")]
script = ExtResource("1_rikml")
waves = Array[ExtResource("2_vc03v")]([ExtResource("3_grv7h")])
spawners = [NodePath("../BackGround/EnemySpawns/EnemySpawnPoint01"), null]

[node name="WaveTimer" type="Timer" parent="WaveManager"]

[node name="UICancel" type="Node2D" parent="."]
script = ExtResource("7_tck0d")

[node name="Area2D" type="Area2D" parent="UICancel"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="UICancel/Area2D"]
position = Vector2(192, 108)
shape = SubResource("RectangleShape2D_u8lgh")
debug_color = Color(5.2943824e-07, 0.23340449, 0.27829906, 0.41960785)

[node name="BackGround" type="Node2D" parent="."]
z_index = -100

[node name="ParticleBackground" parent="BackGround" instance=ExtResource("3_u1xfj")]
self_modulate = Color(1, 1, 1, 0.29411766)

[node name="Pipes" type="Node2D" parent="BackGround"]

[node name="Red" type="Node2D" parent="BackGround/Pipes"]

[node name="redPipe1" parent="BackGround/Pipes/Red" instance=ExtResource("1_nha0i")]
position = Vector2(280, 218)
direction = Vector2i(0, 1)

[node name="redPipe2" parent="BackGround/Pipes/Red" instance=ExtResource("1_nha0i")]
position = Vector2(264, 5)
rotation = -3.14159
direction = Vector2i(0, -1)

[node name="Blue" type="Node2D" parent="BackGround/Pipes"]

[node name="bluePipe1" parent="BackGround/Pipes/Blue" instance=ExtResource("1_nha0i")]
position = Vector2(88, 203)
pipe_type = 1
direction = Vector2i(0, 1)

[node name="bluePipe2" parent="BackGround/Pipes/Blue" instance=ExtResource("1_nha0i")]
position = Vector2(4, 56)
rotation = 1.5708
pipe_type = 1
direction = Vector2i(-1, 0)

[node name="EnemySpawns" type="Node2D" parent="BackGround"]

[node name="EnemySpawnPoint01" parent="BackGround/EnemySpawns" node_paths=PackedStringArray("_paths") instance=ExtResource("4_1rhdn")]
position = Vector2(200, 48)
delete_enemy_at_path_end = false
_paths = [NodePath("Path02"), NodePath("Path01"), NodePath("Path03")]

[node name="Path01" parent="BackGround/EnemySpawns/EnemySpawnPoint01" index="4"]
curve = SubResource("Curve2D_tck0d")

[node name="Path02" parent="BackGround/EnemySpawns/EnemySpawnPoint01" index="5"]
curve = SubResource("Curve2D_u8lgh")

[node name="Path03" parent="BackGround/EnemySpawns/EnemySpawnPoint01" index="6"]
curve = SubResource("Curve2D_hjnkw")

[node name="SpawnTimer" parent="BackGround/EnemySpawns/EnemySpawnPoint01" index="7"]
wait_time = 5.0
autostart = false

[node name="Midground" type="Node2D" parent="."]

[node name="Bridges" type="Node2D" parent="Midground"]
z_index = 1

[node name="Foreground" type="Node2D" parent="."]
z_index = 100

[node name="Particles" type="Node2D" parent="Foreground"]

[node name="BridgeBuilder" parent="." node_paths=PackedStringArray("bridges_container") instance=ExtResource("4_abcde")]
bridges_container = NodePath("../Midground/Bridges")

[node name="FPSCounter" parent="." instance=ExtResource("8_ko0rf")]
visible = false

[node name="UIManager" type="Node" parent="."]
script = ExtResource("5_abcde")
overlay_path = NodePath("../UILayer/Overlay")
ui_layer_path = NodePath("../UILayer")
theme = ExtResource("10_theme")

[node name="UILayer" type="CanvasLayer" parent="."]
layer = 10

[node name="Overlay" type="ColorRect" parent="UILayer"]
visible = false
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 1
color = Color(0, 0, 0, 0.5)
script = ExtResource("6_overlay")

[node name="GameUI" parent="UILayer" instance=ExtResource("9_gameui")]

[node name="OverPanelContainer" type="PanelContainer" parent="UILayer"]
modulate = Color(1, 1, 1, 0)
anchors_preset = -1
anchor_left = 0.521
anchor_top = 0.5
anchor_right = 0.521
anchor_bottom = 0.5
offset_left = -205.06401
offset_top = -20.0
offset_right = 204.93599
offset_bottom = 20.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4
size_flags_vertical = 4
mouse_filter = 2

[node name="ColorRect" type="ColorRect" parent="UILayer/OverPanelContainer"]
layout_mode = 2
mouse_filter = 2
color = Color(0.016551748, 0.016551716, 0.016551724, 0.49019608)

[node name="CenterContainer" type="CenterContainer" parent="UILayer/OverPanelContainer"]
layout_mode = 2

[node name="PanelContainer" type="PanelContainer" parent="UILayer/OverPanelContainer/CenterContainer"]
layout_mode = 2
mouse_filter = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_jsdfw")

[node name="overLabel" type="Label" parent="UILayer/OverPanelContainer/CenterContainer/PanelContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 24
text = "修复完成，模拟成功！"
horizontal_alignment = 1
vertical_alignment = 1

[node name="ShaderRect" type="ColorRect" parent="UILayer/OverPanelContainer"]
material = SubResource("ShaderMaterial_u8lgh")
layout_mode = 2
mouse_filter = 2

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_tck0d")
}

[node name="TutorialManager" type="Node" parent="."]
script = ExtResource("16_tutorial_mgr")
initial_dialogue = ExtResource("17_tutorial_dialogue")
post_connect_dialogue = ExtResource("18_post_connect_dialogue")
upgrade_dialogue = ExtResource("19_upgrade_dialogue")


[connection signal="input_event" from="UICancel/Area2D" to="UICancel" method="_on_area_2d_input_event"]



[editable path="BackGround/EnemySpawns/EnemySpawnPoint01"]
